import{o as z}from"./operacionesService-DZShys_E.js";import{a as A,T as M,E as V,h as t,w as l,g as v,r as c,U as S,o as s,W as B,b as u,I as _,e as p,t as g,N as D,f as E}from"./index-DlKmiQXQ.js";const $={__name:"MatrizPermisos",setup(G){var h,U;const f=v(!1),b=v([]),y=v(null),k=A(),d=(((h=k.user)==null?void 0:h.roles)||[]).includes("Administrador")||((U=k.user)==null?void 0:U.rol_principal)==="Administrador",C=async o=>{var r,a;y.value=o.id_rol;try{await z.actualizarPermisosRol(o.id_rol,{crea_alumnos:!!o.crea_alumnos,crea_cursos:!!o.crea_cursos,registra_notas:!!o.registra_notas,registra_pagos:!!o.registra_pagos,ver_reportes:!!o.ver_reportes}),V.success(`Permisos actualizados para ${o.rol}`)}catch(i){V.error(((a=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:a.message)||"No se pudo actualizar permisos")}finally{y.value=null}};return M(async()=>{var o,r;f.value=!0;try{const{data:a}=await z.matrizPermisos();b.value=a}catch(a){V.error(((r=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:r.message)||"No se pudo cargar la matriz de permisos")}finally{f.value=!1}}),(o,r)=>{const a=c("el-table-column"),i=c("el-checkbox"),m=c("el-tag"),N=c("el-button"),R=c("el-table"),x=c("el-card"),P=S("loading");return s(),t(x,null,{header:l(()=>[...r[0]||(r[0]=[E("strong",null,"Matriz de Permisos por Rol",-1)])]),default:l(()=>[B((s(),t(R,{data:b.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[u(a,{prop:"rol",label:"Rol","min-width":"190"}),u(a,{label:"Crea Alumnos","min-width":"130",align:"center"},{default:l(({row:e})=>[_(d)?(s(),t(i,{key:0,modelValue:e.crea_alumnos,"onUpdate:modelValue":n=>e.crea_alumnos=n},null,8,["modelValue","onUpdate:modelValue"])):(s(),t(m,{key:1,type:e.crea_alumnos?"success":"danger",effect:"plain"},{default:l(()=>[p(g(e.crea_alumnos?"✔":"✖"),1)]),_:2},1032,["type"]))]),_:1}),u(a,{label:"Crea Cursos","min-width":"120",align:"center"},{default:l(({row:e})=>[_(d)?(s(),t(i,{key:0,modelValue:e.crea_cursos,"onUpdate:modelValue":n=>e.crea_cursos=n},null,8,["modelValue","onUpdate:modelValue"])):(s(),t(m,{key:1,type:e.crea_cursos?"success":"danger",effect:"plain"},{default:l(()=>[p(g(e.crea_cursos?"✔":"✖"),1)]),_:2},1032,["type"]))]),_:1}),u(a,{label:"Registra Notas","min-width":"130",align:"center"},{default:l(({row:e})=>[_(d)?(s(),t(i,{key:0,modelValue:e.registra_notas,"onUpdate:modelValue":n=>e.registra_notas=n},null,8,["modelValue","onUpdate:modelValue"])):(s(),t(m,{key:1,type:e.registra_notas?"success":"danger",effect:"plain"},{default:l(()=>[p(g(e.registra_notas?"✔":"✖"),1)]),_:2},1032,["type"]))]),_:1}),u(a,{label:"Registra Pagos","min-width":"130",align:"center"},{default:l(({row:e})=>[_(d)?(s(),t(i,{key:0,modelValue:e.registra_pagos,"onUpdate:modelValue":n=>e.registra_pagos=n},null,8,["modelValue","onUpdate:modelValue"])):(s(),t(m,{key:1,type:e.registra_pagos?"success":"danger",effect:"plain"},{default:l(()=>[p(g(e.registra_pagos?"✔":"✖"),1)]),_:2},1032,["type"]))]),_:1}),u(a,{label:"Ver Reportes","min-width":"120",align:"center"},{default:l(({row:e})=>[_(d)?(s(),t(i,{key:0,modelValue:e.ver_reportes,"onUpdate:modelValue":n=>e.ver_reportes=n},null,8,["modelValue","onUpdate:modelValue"])):(s(),t(m,{key:1,type:e.ver_reportes?"success":"danger",effect:"plain"},{default:l(()=>[p(g(e.ver_reportes?"✔":"✖"),1)]),_:2},1032,["type"]))]),_:1}),_(d)?(s(),t(a,{key:0,label:"Guardar","min-width":"110",align:"center"},{default:l(({row:e})=>[u(N,{type:"primary",size:"small",loading:y.value===e.id_rol,onClick:n=>C(e)},{default:l(()=>[...r[1]||(r[1]=[p("Guardar",-1)])]),_:1},8,["loading","onClick"])]),_:1})):D("",!0)]),_:1},8,["data"])),[[P,f.value]])]),_:1})}}};export{$ as default};
