import{_ as ae,a as oe,T as ue,h as c,w as o,E as V,r as d,g as s,U as te,o as i,b as a,V as re,c as y,F as C,i as x,e as w,W as ie,N as H,f as L,O as de,X as ne,S as se}from"./index-DlKmiQXQ.js";import{o as U}from"./operacionesService-DZShys_E.js";const me={class:"header-row"},ce={__name:"ListadoCursos",setup(pe){const N=s(!1),D=s([]),E=s([]),B=s([]),M=s([]),T=oe(),g=s(!1),h=s(!1),q=s(null),P=s(!1),A=s(null),S=s(null),R=()=>({id_materia:null,id_docente:null,id_periodo:null,nombre_curso:"",aula:"",horario:"",tipo_curso:"Presencial",cupo_maximo:40}),t=s(R()),z=de(()=>{var u,e;return se(["Administrador","Coordinador","Secretaria Académica"],[...((u=T.user)==null?void 0:u.roles)||[],(e=T.user)==null?void 0:e.rol_principal].filter(Boolean))}),$={id_materia:[{required:!0,message:"Materia requerida",trigger:"change"}],id_docente:[{required:!0,message:"Docente requerido",trigger:"change"}],id_periodo:[{required:!0,message:"Periodo requerido",trigger:"change"}],nombre_curso:[{required:!0,message:"Nombre requerido",trigger:"blur"}],tipo_curso:[{required:!0,message:"Tipo requerido",trigger:"change"}],cupo_maximo:[{required:!0,message:"Cupo requerido",trigger:"change"}]},p=s({search:"",id_periodo:null,id_docente:null,id_materia:null}),I=async()=>{const{data:u}=await U.catalogs();E.value=u.periodos||[],B.value=u.docentes||[],M.value=u.materias||[]},k=async()=>{var u,e;N.value=!0;try{const{data:r}=await U.listarCursos(p.value);D.value=r}catch(r){V.error(((e=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:e.message)||"No se pudo cargar cursos")}finally{N.value=!1}},K=()=>{h.value=!1,q.value=null,t.value=R(),g.value=!0},G=u=>{h.value=!0,q.value=u.id_curso,t.value={id_materia:u.id_materia??null,id_docente:u.id_docente??null,id_periodo:u.id_periodo??null,nombre_curso:u.nombre_curso??"",aula:u.aula??"",horario:u.horario??"",tipo_curso:u.tipo_curso??"Presencial",cupo_maximo:u.cupo_maximo??40},g.value=!0},O=async()=>{var u,e,r;await((u=S.value)==null?void 0:u.validate()),P.value=!0;try{h.value&&q.value?(await U.actualizarCurso(q.value,t.value),V.success("Curso actualizado correctamente")):(await U.crearCurso(t.value),V.success("Curso creado correctamente")),g.value=!1,await k()}catch(m){V.error(((r=(e=m==null?void 0:m.response)==null?void 0:e.data)==null?void 0:r.message)||"No se pudo guardar el curso")}finally{P.value=!1}},W=async u=>{var e,r;try{await ne.confirm(`Se eliminará el curso ${u.nombre_curso}. ¿Deseas continuar?`,"Confirmar eliminación",{type:"warning",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"})}catch{return}A.value=u.id_curso;try{await U.eliminarCurso(u.id_curso),V.success("Curso eliminado correctamente"),await k()}catch(m){V.error(((r=(e=m==null?void 0:m.response)==null?void 0:e.data)==null?void 0:r.message)||"No se pudo eliminar el curso")}finally{A.value=null}};return ue(async()=>{await I(),await k()}),(u,e)=>{const r=d("el-button"),m=d("el-input"),n=d("el-col"),_=d("el-option"),b=d("el-select"),F=d("el-row"),v=d("el-table-column"),X=d("el-space"),j=d("el-table"),f=d("el-form-item"),J=d("el-input-number"),Q=d("el-form"),Y=d("el-dialog"),Z=d("el-card"),ee=te("loading");return i(),c(Z,null,{header:o(()=>[L("div",me,[e[15]||(e[15]=L("strong",null,"Listado de Cursos",-1)),z.value?(i(),c(r,{key:0,type:"primary",onClick:K},{default:o(()=>[...e[14]||(e[14]=[w("Nuevo Curso",-1)])]),_:1})):H("",!0)])]),default:o(()=>[a(F,{gutter:12,class:"toolbar-row"},{default:o(()=>[a(n,{xs:24,md:8},{default:o(()=>[a(m,{modelValue:p.value.search,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value.search=l),placeholder:"Buscar por curso/materia/docente",clearable:"",onKeyup:re(k,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{xs:24,md:5},{default:o(()=>[a(b,{modelValue:p.value.id_periodo,"onUpdate:modelValue":e[1]||(e[1]=l=>p.value.id_periodo=l),clearable:"",placeholder:"Periodo",style:{width:"100%"}},{default:o(()=>[(i(!0),y(C,null,x(E.value,l=>(i(),c(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{xs:24,md:5},{default:o(()=>[a(b,{modelValue:p.value.id_docente,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value.id_docente=l),clearable:"",filterable:"",placeholder:"Docente",style:{width:"100%"}},{default:o(()=>[(i(!0),y(C,null,x(B.value,l=>(i(),c(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{xs:24,md:4},{default:o(()=>[a(b,{modelValue:p.value.id_materia,"onUpdate:modelValue":e[3]||(e[3]=l=>p.value.id_materia=l),clearable:"",filterable:"",placeholder:"Materia",style:{width:"100%"}},{default:o(()=>[(i(!0),y(C,null,x(M.value,l=>(i(),c(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{xs:24,md:2,class:"toolbar-actions"},{default:o(()=>[a(r,{type:"primary",onClick:k},{default:o(()=>[...e[16]||(e[16]=[w("Filtrar",-1)])]),_:1})]),_:1})]),_:1}),ie((i(),c(j,{data:D.value,border:"",stripe:"",style:{width:"100%"}},{default:o(()=>[a(v,{prop:"nombre_curso",label:"Curso","min-width":"220"}),a(v,{prop:"materia",label:"Materia","min-width":"180"}),a(v,{prop:"docente",label:"Docente","min-width":"180"}),a(v,{prop:"periodo",label:"Periodo","min-width":"120"}),a(v,{prop:"aula",label:"Aula","min-width":"90"}),a(v,{prop:"horario",label:"Horario","min-width":"160"}),a(v,{prop:"tipo_curso",label:"Tipo","min-width":"120"}),a(v,{prop:"cupo_maximo",label:"Cupo","min-width":"90"}),z.value?(i(),c(v,{key:0,label:"Acciones","min-width":"180",fixed:"right"},{default:o(({row:l})=>[a(X,null,{default:o(()=>[a(r,{size:"small",onClick:le=>G(l)},{default:o(()=>[...e[17]||(e[17]=[w("Editar",-1)])]),_:1},8,["onClick"]),a(r,{size:"small",type:"danger",loading:A.value===l.id_curso,onClick:le=>W(l)},{default:o(()=>[...e[18]||(e[18]=[w("Eliminar",-1)])]),_:1},8,["loading","onClick"])]),_:2},1024)]),_:1})):H("",!0)]),_:1},8,["data"])),[[ee,N.value]]),a(Y,{modelValue:g.value,"onUpdate:modelValue":e[13]||(e[13]=l=>g.value=l),title:h.value?"Editar Curso":"Nuevo Curso",width:"860px","destroy-on-close":""},{footer:o(()=>[a(r,{onClick:e[12]||(e[12]=l=>g.value=!1)},{default:o(()=>[...e[19]||(e[19]=[w("Cancelar",-1)])]),_:1}),a(r,{type:"primary",loading:P.value,onClick:O},{default:o(()=>[...e[20]||(e[20]=[w("Guardar",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(Q,{ref_key:"formRef",ref:S,model:t.value,rules:$,"label-position":"top"},{default:o(()=>[a(F,{gutter:12},{default:o(()=>[a(n,{xs:24,md:12},{default:o(()=>[a(f,{label:"Materia",prop:"id_materia"},{default:o(()=>[a(b,{modelValue:t.value.id_materia,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.id_materia=l),filterable:"",style:{width:"100%"}},{default:o(()=>[(i(!0),y(C,null,x(M.value,l=>(i(),c(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:12},{default:o(()=>[a(f,{label:"Docente",prop:"id_docente"},{default:o(()=>[a(b,{modelValue:t.value.id_docente,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.id_docente=l),filterable:"",style:{width:"100%"}},{default:o(()=>[(i(!0),y(C,null,x(B.value,l=>(i(),c(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:12},{default:o(()=>[a(f,{label:"Periodo",prop:"id_periodo"},{default:o(()=>[a(b,{modelValue:t.value.id_periodo,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.id_periodo=l),style:{width:"100%"}},{default:o(()=>[(i(!0),y(C,null,x(E.value,l=>(i(),c(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:12},{default:o(()=>[a(f,{label:"Nombre Curso",prop:"nombre_curso"},{default:o(()=>[a(m,{modelValue:t.value.nombre_curso,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.nombre_curso=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:12},{default:o(()=>[a(f,{label:"Aula",prop:"aula"},{default:o(()=>[a(m,{modelValue:t.value.aula,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.aula=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:12},{default:o(()=>[a(f,{label:"Horario",prop:"horario"},{default:o(()=>[a(m,{modelValue:t.value.horario,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.horario=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:12},{default:o(()=>[a(f,{label:"Tipo Curso",prop:"tipo_curso"},{default:o(()=>[a(b,{modelValue:t.value.tipo_curso,"onUpdate:modelValue":e[10]||(e[10]=l=>t.value.tipo_curso=l),style:{width:"100%"}},{default:o(()=>[a(_,{label:"Presencial",value:"Presencial"}),a(_,{label:"Virtual",value:"Virtual"}),a(_,{label:"Híbrido",value:"Híbrido"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(n,{xs:24,md:12},{default:o(()=>[a(f,{label:"Cupo Máximo",prop:"cupo_maximo"},{default:o(()=>[a(J,{modelValue:t.value.cupo_maximo,"onUpdate:modelValue":e[11]||(e[11]=l=>t.value.cupo_maximo=l),min:1,max:999,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}},fe=ae(ce,[["__scopeId","data-v-c3669283"]]);export{fe as default};
