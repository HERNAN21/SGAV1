import{_ as le,a as oe,T as te,h as p,w as o,E as b,r as n,g as m,U as ue,o as i,b as a,V as de,c as A,F as C,i as E,e as V,W as re,N as P,f as T,O as se,X as ne,S as ie}from"./index-DlKmiQXQ.js";import{o as k}from"./operacionesService-DZShys_E.js";const me={class:"header-row"},ce={__name:"ListadoAlumnos",setup(pe){const U=m(!1),F=m([]),S=oe(),N=m([]),M=m([]),h=m([]),v=m(!1),f=m(!1),q=m(null),B=m(!1),D=m(null),I=m(null),R=()=>({documento:"",codigo_estudiante:"",nombres:"",apellidos:"",email:"",password:"",id_facultad:null,id_programa:null,id_estado_academico:1,fecha_ingreso:""}),u=m(R()),z=se(()=>{var t,e;return ie(["Administrador","Secretaria Académica"],[...((t=S.user)==null?void 0:t.roles)||[],(e=S.user)==null?void 0:e.rol_principal].filter(Boolean))}),Y={documento:[{required:!0,message:"Documento requerido",trigger:"blur"}],codigo_estudiante:[{required:!0,message:"Código requerido",trigger:"blur"}],nombres:[{required:!0,message:"Nombres requeridos",trigger:"blur"}],apellidos:[{required:!0,message:"Apellidos requeridos",trigger:"blur"}],email:[{required:!0,message:"Email requerido",trigger:"blur"},{type:"email",message:"Email inválido",trigger:"blur"}],password:[{validator:(t,e,d)=>{if(f.value&&!e){d();return}if(!e||String(e).length<6){d(new Error("Contraseña mínima 6 caracteres"));return}d()},trigger:"blur"}],id_facultad:[{required:!0,message:"Facultad requerida",trigger:"change"}],id_programa:[{required:!0,message:"Programa requerido",trigger:"change"}],id_estado_academico:[{required:!0,message:"Estado requerido",trigger:"change"}],fecha_ingreso:[{required:!0,message:"Fecha requerida",trigger:"change"}]},g=m({search:"",id_programa:null,id_estado_academico:null}),$=async()=>{const{data:t}=await k.catalogs();M.value=t.facultades||[],N.value=t.programas||[],h.value=t.estadosAcademicos||[]},y=async()=>{var t,e;U.value=!0;try{const{data:d}=await k.listarAlumnos(g.value);F.value=d}catch(d){b.error(((e=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:e.message)||"No se pudo cargar alumnos")}finally{U.value=!1}},K=()=>{f.value=!1,q.value=null,u.value=R(),v.value=!0},G=t=>{f.value=!0,q.value=t.id_estudiante,u.value={documento:t.documento||"",codigo_estudiante:t.codigo_estudiante||"",nombres:t.nombres||"",apellidos:t.apellidos||"",email:t.email||"",password:"",id_facultad:t.id_facultad||null,id_programa:t.id_programa||null,id_estado_academico:t.id_estado_academico||null,fecha_ingreso:t.fecha_ingreso||""},v.value=!0},O=async()=>{var t,e,d;await((t=I.value)==null?void 0:t.validate()),B.value=!0;try{f.value&&q.value?(await k.actualizarAlumno(q.value,u.value),b.success("Alumno actualizado correctamente")):(await k.crearAlumno(u.value),b.success("Alumno creado correctamente")),v.value=!1,await y()}catch(r){b.error(((d=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:d.message)||"No se pudo guardar el alumno")}finally{B.value=!1}},W=async t=>{var e,d;try{await ne.confirm(`Se eliminará al alumno ${t.estudiante}. ¿Deseas continuar?`,"Confirmar eliminación",{type:"warning",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"})}catch{return}D.value=t.id_estudiante;try{await k.eliminarAlumno(t.id_estudiante),b.success("Alumno eliminado correctamente"),await y()}catch(r){b.error(((d=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:d.message)||"No se pudo eliminar el alumno")}finally{D.value=null}};return te(async()=>{await $(),await y()}),(t,e)=>{const d=n("el-button"),r=n("el-input"),s=n("el-col"),w=n("el-option"),x=n("el-select"),L=n("el-row"),_=n("el-table-column"),X=n("el-space"),j=n("el-table"),c=n("el-form-item"),H=n("el-date-picker"),J=n("el-form"),Q=n("el-dialog"),Z=n("el-card"),ee=ue("loading");return i(),p(Z,null,{header:o(()=>[T("div",me,[e[16]||(e[16]=T("strong",null,"Listado de Alumnos",-1)),z.value?(i(),p(d,{key:0,type:"primary",onClick:K},{default:o(()=>[...e[15]||(e[15]=[V("Nuevo Alumno",-1)])]),_:1})):P("",!0)])]),default:o(()=>[a(L,{gutter:12,class:"toolbar-row"},{default:o(()=>[a(s,{xs:24,md:8},{default:o(()=>[a(r,{modelValue:g.value.search,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value.search=l),placeholder:"Buscar por nombre/documento/código",clearable:"",onKeyup:de(y,["enter"])},null,8,["modelValue"])]),_:1}),a(s,{xs:24,md:6},{default:o(()=>[a(x,{modelValue:g.value.id_programa,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value.id_programa=l),clearable:"",placeholder:"Programa",style:{width:"100%"}},{default:o(()=>[(i(!0),A(C,null,E(N.value,l=>(i(),p(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{xs:24,md:6},{default:o(()=>[a(x,{modelValue:g.value.id_estado_academico,"onUpdate:modelValue":e[2]||(e[2]=l=>g.value.id_estado_academico=l),clearable:"",placeholder:"Estado Académico",style:{width:"100%"}},{default:o(()=>[(i(!0),A(C,null,E(h.value,l=>(i(),p(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{xs:24,md:4,class:"toolbar-actions"},{default:o(()=>[a(d,{type:"primary",onClick:y},{default:o(()=>[...e[17]||(e[17]=[V("Filtrar",-1)])]),_:1})]),_:1})]),_:1}),re((i(),p(j,{data:F.value,border:"",stripe:"",style:{width:"100%"}},{default:o(()=>[a(_,{prop:"codigo_estudiante",label:"Código","min-width":"120"}),a(_,{prop:"estudiante",label:"Alumno","min-width":"220"}),a(_,{prop:"documento",label:"Documento","min-width":"120"}),a(_,{prop:"email",label:"Email","min-width":"220"}),a(_,{prop:"programa",label:"Programa","min-width":"220"}),a(_,{prop:"estado_academico",label:"Estado","min-width":"130"}),a(_,{prop:"fecha_ingreso",label:"Ingreso","min-width":"120"}),z.value?(i(),p(_,{key:0,label:"Acciones","min-width":"180",fixed:"right"},{default:o(({row:l})=>[a(X,null,{default:o(()=>[a(d,{size:"small",onClick:ae=>G(l)},{default:o(()=>[...e[18]||(e[18]=[V("Editar",-1)])]),_:1},8,["onClick"]),a(d,{size:"small",type:"danger",loading:D.value===l.id_estudiante,onClick:ae=>W(l)},{default:o(()=>[...e[19]||(e[19]=[V("Eliminar",-1)])]),_:1},8,["loading","onClick"])]),_:2},1024)]),_:1})):P("",!0)]),_:1},8,["data"])),[[ee,U.value]]),a(Q,{modelValue:v.value,"onUpdate:modelValue":e[14]||(e[14]=l=>v.value=l),title:f.value?"Editar Alumno":"Nuevo Alumno",width:"900px","destroy-on-close":""},{footer:o(()=>[a(d,{onClick:e[13]||(e[13]=l=>v.value=!1)},{default:o(()=>[...e[20]||(e[20]=[V("Cancelar",-1)])]),_:1}),a(d,{type:"primary",loading:B.value,onClick:O},{default:o(()=>[...e[21]||(e[21]=[V("Guardar",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(J,{ref_key:"formRef",ref:I,model:u.value,rules:Y,"label-position":"top"},{default:o(()=>[a(L,{gutter:12},{default:o(()=>[a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Documento",prop:"documento"},{default:o(()=>[a(r,{modelValue:u.value.documento,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.documento=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Código Estudiante",prop:"codigo_estudiante"},{default:o(()=>[a(r,{modelValue:u.value.codigo_estudiante,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.codigo_estudiante=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Nombres",prop:"nombres"},{default:o(()=>[a(r,{modelValue:u.value.nombres,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.nombres=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Apellidos",prop:"apellidos"},{default:o(()=>[a(r,{modelValue:u.value.apellidos,"onUpdate:modelValue":e[6]||(e[6]=l=>u.value.apellidos=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Email",prop:"email"},{default:o(()=>[a(r,{modelValue:u.value.email,"onUpdate:modelValue":e[7]||(e[7]=l=>u.value.email=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:f.value?"Contraseña (opcional)":"Contraseña",prop:"password"},{default:o(()=>[a(r,{modelValue:u.value.password,"onUpdate:modelValue":e[8]||(e[8]=l=>u.value.password=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Facultad",prop:"id_facultad"},{default:o(()=>[a(x,{modelValue:u.value.id_facultad,"onUpdate:modelValue":e[9]||(e[9]=l=>u.value.id_facultad=l),style:{width:"100%"}},{default:o(()=>[(i(!0),A(C,null,E(M.value,l=>(i(),p(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Programa",prop:"id_programa"},{default:o(()=>[a(x,{modelValue:u.value.id_programa,"onUpdate:modelValue":e[10]||(e[10]=l=>u.value.id_programa=l),style:{width:"100%"}},{default:o(()=>[(i(!0),A(C,null,E(N.value,l=>(i(),p(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Estado Académico",prop:"id_estado_academico"},{default:o(()=>[a(x,{modelValue:u.value.id_estado_academico,"onUpdate:modelValue":e[11]||(e[11]=l=>u.value.id_estado_academico=l),style:{width:"100%"}},{default:o(()=>[(i(!0),A(C,null,E(h.value,l=>(i(),p(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(s,{xs:24,md:12},{default:o(()=>[a(c,{label:"Fecha Ingreso",prop:"fecha_ingreso"},{default:o(()=>[a(H,{modelValue:u.value.fecha_ingreso,"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.fecha_ingreso=l),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}},fe=le(ce,[["__scopeId","data-v-a750da89"]]);export{fe as default};
